import { ProjectsModel } from '../models/projects';
import { asyncHandler } from './middleware/errorHandler';
import { ApiError, NotFoundError, ValidationError } from './middleware/errorHandler';
//import { COLORS } from '../../../frontend/src/constants/colors';

const express = require("express");
const router = express.Router();

export default function apiRoutes() {
    router.get("/:id/badge.svg", asyncHandler(async (req, res) => {
        const projectsModel = new ProjectsModel();
        const project = await projectsModel.findOne(req.params.id);

        if (!project) {
            throw new NotFoundError('Project not found');
        }

        const svg = `
<svg
   width="266.5773"
   height="162.61765"
   viewBox="0 0 70.53191 43.025909"
   version="1.1"
   id="svg1"
   xml:space="preserve"
   xmlns:xlink="http://www.w3.org/1999/xlink"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs1"><linearGradient
       id="linearGradient7"><stop
         style="stop-color:#00796b;stop-opacity:1;"
         offset="0"
         id="stop7" /><stop
         style="stop-color:#00796b;stop-opacity:0.1;"
         offset="0.30413625"
         id="stop8" /></linearGradient><linearGradient
       id="linearGradient5"><stop
         style="stop-color:#ffd54f;stop-opacity:1;"
         offset="0"
         id="stop5" /><stop
         style="stop-color:#ffd54f;stop-opacity:0.1;"
         offset="0.9026764"
         id="stop6" /></linearGradient><linearGradient
       id="linearGradient3"><stop
         style="stop-color:#a8e6cf;stop-opacity:1;"
         offset="0"
         id="stop3" /><stop
         style="stop-color:#a8e6cf;stop-opacity:0.1;"
         offset="0.70072991"
         id="stop4" /></linearGradient><linearGradient
       xlink:href="#linearGradient3"
       id="linearGradient4"
       x1="46.04705"
       y1="106.84637"
       x2="104.51996"
       y2="106.84637"
       gradientUnits="userSpaceOnUse"
       gradientTransform="translate(-0.03789564,4.3599433)" /><linearGradient
       xlink:href="#linearGradient5"
       id="linearGradient6"
       x1="46.17934"
       y1="117.87965"
       x2="104.38767"
       y2="117.87965"
       gradientUnits="userSpaceOnUse"
       gradientTransform="translate(0,4.3599319)" /><linearGradient
       xlink:href="#linearGradient7"
       id="linearGradient8"
       x1="46.17934"
       y1="128.91293"
       x2="104.38767"
       y2="128.91293"
       gradientUnits="userSpaceOnUse"
       gradientTransform="translate(0,4.3599319)" /></defs><g
     id="layer1"
     transform="translate(-33.855764,-94.215718)"><path
       style="fill:#00796b;fill-opacity:1;stroke-width:0.264583"
       id="path1"
       d="m 82.357584,54.184143 -14.972911,25.933842 -29.945822,0 -14.972911,-25.933842 14.972911,-25.933842 29.945822,0 z"
       transform="matrix(0.14069935,0,0,0.15303363,30.694821,124.98089)" /><rect
       style="fill:#ffd54f;fill-opacity:1;stroke-width:0.0380479"
       id="rect1"
       width="7.9375"
       height="7.9375"
       x="34.100372"
       y="118.27084" /><circle
       style="fill:#a8e6cf;fill-opacity:1;stroke-width:0.0334454"
       id="path2"
       cx="38.069122"
       cy="111.20628"
       r="3.96875" /><rect
       style="fill:url(#linearGradient4);stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       id="rect2"
       width="58.208332"
       height="7.9375"
       x="46.141445"
       y="107.23753" /><rect
       style="fill:url(#linearGradient6);stroke-width:0.277015"
       id="rect2-5"
       width="58.208332"
       height="7.9375"
       x="46.17934"
       y="118.27084" /><rect
       style="fill:url(#linearGradient8);stroke-width:0.277015"
       id="rect2-53"
       width="58.208332"
       height="7.9375"
       x="46.17934"
       y="129.30406" /><text
       xml:space="preserve"
       style="font-size:4.93889px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="61.580826"
       y="110.52911"
       id="text8"><tspan
         id="tspan8"
         style="font-weight:bold;font-size:4.93889px;stroke-width:0.264583"
         x="61.580826"
         y="110.52911">Best Practices</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="48.090366"
       y="112.58569"
       id="text9"><tspan
         id="tspan9"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="48.090366"
         y="112.58569">Best Practices</tspan></text><text
       xml:space="preserve"
       style="font-size:5.64444px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="45.989861"
       y="100.09022"
       id="text9-5"><tspan
         id="tspan9-7"
         style="font-style:normal;font-variant:normal;font-weight:900;font-stretch:normal;font-size:5.64444px;font-family:Roboto;-inkscape-font-specification:'Roboto Heavy';fill:#000000;stroke-width:0.264583"
         x="45.989861"
         y="100.09022">gitgud</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="48.173737"
       y="123.30064"
       id="text9-2"><tspan
         id="tspan9-4"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="48.173737"
         y="123.30064">Compliance</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="93.116066"
       y="112.58569"
       id="text9-6"><tspan
         id="tspan9-6"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="93.116066"
         y="112.58569">70%</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="93.116066"
       y="123.61993"
       id="text9-6-1"><tspan
         id="tspan9-6-7"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="93.116066"
         y="123.61993">90%</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="93.116066"
       y="134.65317"
       id="text9-6-1-9"><tspan
         id="tspan9-6-7-5"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="93.116066"
         y="134.65317">30%</tspan></text><text
       xml:space="preserve"
       style="font-size:3.88056px;fill:none;fill-opacity:1;stroke:none;stroke-width:0.264583;stroke-dasharray:none;stroke-opacity:1"
       x="48.090366"
       y="134.70906"
       id="text9-7"><tspan
         id="tspan9-48"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.88056px;font-family:Roboto;-inkscape-font-specification:'Roboto Bold';fill:#000000;stroke-width:0.264583"
         x="48.090366"
         y="134.70906">Resilience</tspan></text><g
       id="g12"
       transform="matrix(0.0154886,0,0,0.0154886,34.200777,94.591841)">&#10;	<path
   style="fill:#32393f"
   d="m 511.092,70.526 c -4.541,-26.265 -19.765,-47.49 -41.034,-59.78 -42.979,-24.8 -98.484,-4.204 -127.474,45.996 l -2.329,4.248 126.36,113.487 c 11.558,-9.229 21.27,-14.596 28.887,-27.794 13.769,-23.848 19.955,-50.903 15.59,-76.157 z"
   id="path1-0" />&#10;	<path
   style="fill:#575f64"
   d="M 169.757,56.68 C 140.797,6.524 84.32,-14.042 41.313,10.743 20.043,23.033 5.82,44.259 1.279,70.523 -5.82,111.595 19.768,155.23 52.254,180.87 L 172.232,61.177 Z"
   id="path2-4" />&#10;	<path
   style="fill:#ececf1"
   d="m 391,210.237 -32.999,235.8 c -6.301,12.9 -11.4,24.6 -15.601,34.2 -6.899,17.1 -10.201,30.2 -11.4,32 l -18.3,-32 H 199.3 l -18.3,32 c -1.199,-1.8 -4.501,-14.9 -11.4,-32 -4.2,-9.6 -9.3,-21.301 -15.601,-34.2 L 121,210.237 164.5,48.837 c 28.5,-11.7 59.399,-18.6 91.5,-18.6 32.101,0 62.999,6.899 91.5,18.6 z"
   id="path3" />&#10;	<path
   style="fill:#d3d3d8"
   d="m 391,210.237 -32.999,235.8 c -6.301,12.9 -11.4,24.6 -15.601,34.2 -6.899,17.1 -10.201,30.2 -11.4,32 l -18.3,-32 H 256 v -450 c 32.1,0 62.999,6.899 91.5,18.6 z"
   id="path4" />&#10;	<path
   style="fill:#32393f"
   d="M 96.922,103.962 C 96.336,102.497 95.648,101.047 94.827,99.626 89.803,90.91 83.782,88.596 81.014,88.596 v -30 c 15.513,0 30.381,9.727 39.785,26.016 1.538,2.666 2.871,5.435 3.984,8.218 z"
   id="path5" />&#10;	<path
   style="fill:#24292d"
   d="M 415.565,103.684 387.792,92.317 c 1.04,-2.534 2.3,-5.142 3.823,-7.749 10.547,-18.281 26.88,-26.47 38.394,-26.47 v 30 c -1.055,0.176 -7.368,2.71 -12.437,11.499 -0.82,1.407 -1.465,2.754 -2.007,4.087 z"
   id="path6" />&#10;	<path
   style="fill:#7c8388"
   d="M 331,512.237 H 181 l 17.401,-55.101 c 11.699,-23.399 33.3,-36.899 57.599,-36.899 24.299,0 45.901,13.5 56.7,35.099 z"
   id="path7" />&#10;	<path
   style="fill:#575f64"
   d="m 331,512.237 h -75 v -92 c 24.3,0 45.901,13.5 56.7,35.099 z"
   id="path8" />&#10;	<path
   style="fill:#575f64"
   d="M 374.493,61.819 C 365.759,56.912 356.787,52.528 347.476,48.727 L 309.73,136.79 C 293.983,173.543 286,212.434 286,252.395 c 0,63.105 20.845,125.654 58.711,176.104 l 13.01,17.349 L 474.18,168.396 C 452.203,122.575 417.221,85.824 374.493,61.819 Z"
   id="path9" />&#10;	<rect
   x="331"
   y="240.237"
   style="fill:#24292d"
   width="30"
   height="30"
   id="rect9" />&#10;	<path
   style="fill:#7c8388"
   d="m 137.507,61.819 c 8.734,-4.907 17.706,-9.291 27.017,-13.092 l 37.745,88.063 C 218.017,173.543 226,212.434 226,252.395 226,315.5 205.155,378.049 167.289,428.499 L 154.279,445.848 37.821,168.395 C 59.797,122.575 94.779,85.824 137.507,61.819 Z"
   id="path10" />&#10;	<rect
   x="151"
   y="240.237"
   style="fill:#32393f"
   width="30"
   height="30"
   id="rect10" />&#10;	<path
   style="fill:#d3d3d8"
   d="m 478.876,177.205 c -1.329,-3.104 -3.246,-5.788 -4.697,-8.809 -57.964,56.618 -96.114,134.174 -109.427,227.921 l -7.031,49.532 0.15,0.201 C 415.829,328.648 490.512,279.403 512,260.159 508.377,251.705 477.254,173.42 478.876,177.205 Z"
   id="path11" />&#10;	<path
   style="fill:#ececf1"
   d="m 33.124,177.205 c 1.329,-3.104 3.246,-5.788 4.697,-8.809 57.964,56.618 96.114,134.174 109.427,227.921 l 7.031,49.532 -0.15,0.201 C 96.171,328.648 21.488,279.403 0,260.159 3.623,251.705 34.746,173.42 33.124,177.205 Z"
   id="path12" />&#10;</g></g></svg>

    `;

        res.setHeader('Content-Type', 'image/svg+xml');
        res.send(svg);
    }));

    return router;
}